---
title: "HW6 Hospital Rankings"
author: "Chrinovic Mukulu"
date: "2025-10-18"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
---

```{r}
install.packages(c("tidyverse", "janitor", "here"))
set.seed(123)
outcome <- read.csv(c("file","outcome-of-care-measures.csv"))
library(tidyverse)
library(janitor)
library(here)

head(outcome)
dim(outcome)

outcome <- janitor::clean_names(outcome)
names(outcome)[1:20] 

suppressWarnings(outcome[[11]] <- as.numeric(outcome[[11]]))

hist(outcome[[11]],
     main = "30-Day Mortality Rates for Heart Attack",
     xlab = "Mortality Rate(%)",
     col = "lightblue"
     )
png(here("fig", "heart_attack_hist.png"))
hist(outcome[[11]],
     main = "30-Day Mortality Rates for Heart Attack",
     xlab = "Mortality Rate (%)",
     col = "lightblue"
     )
dev.off()

best <- function(state, outcome_type) {
  valid_outcomes <- c("heart Attack", "heart failure", "pneumonia")
  if(!(tolower(outcome_type) %in% valid_outcomes)){
    stop("invalid outcome")
  }
}

best <- function(state, outcome_type) {
  if (!(state %in% outcome$state)) {
    stop("invalid state")
  }
}

best <- function(state, outcome_type) {
  # map the outcome to the right column
  outcome_col <- switch(tolower(outcome_type),
    "heart attack"  = "hospital_30_day_death_mortality_rates_from_heart_attack",
    "heart failure" = "hospital_30_day_death_mortality_rates_from_heart_failure",
    "pneumonia"     = "hospital_30_day_death_mortality_rates_from_pneumonia",
  )
  browser(skipCalls = 5)
  print(outcome_col)
  
  state_data <- outcome %>%
    filter(state == state.name) %>%
    select(hospital_name, rate = !!sym(outcome_col)) %>%
     mutate(rate = as.numeric(rate)) %>%
    filter(!is.na(rate))
  head(!is.na(rate))
  
  
  best_hospital <- state_data %>%
    arrange(rate, hospital_name) %>%
    slice(1)%>%
    pull(hospital_name)
  return(best_hospital)

}

rankhospital <- function(state, outcome_type, num = "best") {
  valid_outcomes <- c("heart attack", "heart failure", "pneumonia")
  if (!(tolower(outcome_type) %in% valid_outcomes)) stop("invalid outcome")
  if (!(state %in% outcome$state)) stop("invalid state")
  
  outcome_col <- switch(tolower(outcome_type),
    "heart attack" = "hospital_30_day_death_mortality_rates_from_heart_attack",
    "heart failure" = "hospital_30_day_death_mortality_rates_from_heart_failure",
    "pneumonia"     = "hospital_30_day_death_mortality_rates_from_pneumonia"
  )
  
  dat <- outcome %>%
    filter(state == !!state) %>%
    select(hospital_name, rate = !!sym(outcome_col)) %>%
    mutate(rate = as.numeric(rate)) %>%
    filter(!is.na(rate)) %>%
    arrange(rate, hospital_name)
  
  if (num == "best") 
    return(dat$hospital_name[1])
  if(num == "worst") 
    return(dat$hospital_name[nrow(dat)])
  
  if (num > nrow(dat)) return(NA)
  
  dat$hospital_name[num]

} 

rankall <- function(outcome_type, num = "best") {
  valid_outcomes <- c("heart attack", "heart failure", "pneumonia")
  if (!(tolower(outcome_type) %in% valid_outcomes)) stop("invalid outcome")
  
  outcome_col <- switch(tolower(outcome_type),
    "heart attack"  = "hospital_30_day_death_mortality_rates_from_heart_attack",
    "heart failure" = "hospital_30_day_death_mortality_rates_from_heart_failure",
    "pneumonia"     = "hospital_30_day_death_mortality_rates_from_pneumonia"
  )
  
  dat <- outcome %>%
    select(hospital_name, state, rate = !!sym(outcome_col)) %>%
    mutate(rate = as.numeric(rate)) %>%
    filter(!is.na(rate))
  
  res <- dat %>%
    group_by(state) %>%
    arrange(rate, hospital_name) %>%
    mutate(rank = row_number())
  
  if (num == "best") {
    output <- res%>% filter(rank == 1)
  } 
  else if (num == "worst") {
    output <- res %>% filter(rank == max(rank))
  }
  
  output %>% select(hospital = hospital_name, sate)
  
}

```
